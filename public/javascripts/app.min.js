angular.module("app",["app.tpl","ngSanitize","ngRoute","ngCookies","ui.select","ui.bootstrap","main","pattern"]).constant("API_URL","/api/v1/").config(["$httpProvider","$locationProvider",function(e,t){t.html5Mode({enabled:!0,requireBase:!1})}]).run(["$http","$cookieStore","$log","$window",function(e,t,n,r){e.post("/api/v1/access_token",{grant_type:"client_credentials",client_id:r.Conf.clientId}).then(function(e){t.put("access_token",e.data.access_token)},function(e){n.error(e)})}]).run(["$injector","$cookieStore",function(e,t){e.get("$http").defaults.transformRequest=function(e,n){var r=t.get("access_token");r&&(n().Authorization="Bearer "+r)}}]),angular.module("main.controllers",[]).controller("IndexCtrl",["$scope","$location","$log","$timeout","$templateCache","$modal","DrugService","DrugsList","API_URL",function(e,t,n,r,o,a,i,l,u){function s(){if(e.drug&&e.drug.selected){var t=e.drug.selected,n=_.findWhere(e.followedDrugs,{name:t})||{name:t};n.following=_.includes(l.all(),t),e.drug.selected=void 0;{a.open({animation:e.animationsEnabled,templateUrl:"assets/main/partials/details-modal.html",controller:"DrugDetailsCtrl",resolve:{drug:function(){return n}}}).result}}}function c(){e.followedDrugs=_.map(l.all(),function(e){return{name:e,following:!0}}),_.forEach(e.followedDrugs,function(e){i.getDrugByName(e.name).then(function(t){e.details=t})})}e.endpoint=u+"drugs",e.drug={},i.getTypeaheadDrugs().then(function(t){e.drugs=_.sortBy(t)}),c(),e.highlightClass=function(e){return e.details?e.details.recalls?"drug-status-recall":e.details.labelChanges?"drug-status-label":"drug-status-ok":"drug-status-loading"},e.removeDrug=function(t){l.remove(t.name),e.followedDrugs=_.reject(e.followedDrugs,{name:t.name})},e.hoverFollow=function(){this.followHovered=!0},e.leaveFollow=function(){this.followHovered=!1},e.manuallySelectDrug=function(t){e.drug.selected=t.name},e.$watch("drug",function(){e.drug&&e.drug.selected&&s()},!0)}]).controller("DrugDetailsCtrl",["$scope","$log","$location","$modalInstance","DrugService","DrugsList","drug",function(e,t,n,r,o,a,i){e.drug=i,i.details||o.getDrugByName(e.drug.name).then(function(t){e.drug.details=t}),e.toggleFollow=function(){a[e.drug.following?"remove":"add"](e.drug.name),i.following=!i.following},e.interactionPairConcepts=function(e){return _(e.interactionConcept).map(function(e){return e.minConceptItem.name}).join(", ")},e.showInteractionDetails=function(){return!i.details||!_.isEmpty(i.details.interactionDetails)},e.done=function(){r.close()}}]),angular.module("main.directives",[]).directive("drugSummary",function(){var e=function(e,t){function n(e,n){var r="";if(!e||!e.details)return r;if("recall"===n&&e.details.recalls){var o=e.details.recallDetails.length;1===o?r+="There is an open recall on "+e.name:o>1&&(r+="There are "+o+" open recalls on "+e.name)}return"label"===n&&e.details.labelChanges&&(r+="Label was last changed on "+t("fdaDate")(_.first(e.details.labelDetails).effective_time)),r}e.$watch("drug",function(t){e.description=n(t,e.type)},!0)};return e.$inject=["$scope","$filter"],{restrict:"A",template:"{{description}}",scope:{drug:"=",type:"="},controller:e}}),angular.module("main.filters",[]).filter("encodeURIComponent",function(){return window.encodeURIComponent}).filter("fdaDate",["$filter",function(e){return function(t){var n=t.substring(0,4)+"-"+t.substring(4,6)+"-"+t.substring(6,8);return e("date")(n)}}]),angular.module("main",["main.controllers","main.directives","main.routes","main.services","main.filters"]),angular.module("main.routes",[]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"assets/main/partials/main-index.html",controller:"IndexCtrl"}).when("/drugdetail",{templateUrl:"assets/main/partials/drug-detail.html",controller:"DrugDetailsCtrl"})}]),function(){angular.module("main.services",[]).factory("DrugService",["API_URL","$http","$q","$log",function(e,t,n,r){return{getTypeaheadDrugs:function(){var e=n.defer();return t({url:"/assets/datasets/meds.json"}).success(function(t){e.resolve(t)}).error(function(){e.reject("Problem retrieving drug names for typeahead")}),e.promise},getDrugs:function(r){var o=n.defer(),a={method:"GET",url:e};return r&&(a.params.query=r),t(a).success(function(e){o.resolve(e)}).error(function(e){o.reject("Problem retrieving medicines: "+e)}),o.promise},getDrugByName:function(n){return t.get(e+"drugs/"+n).then(function(e){return e.data},function(e){r.error(e)})}}}]).factory("DrugsList",function(){return{all:function(){var e=window.localStorage.drugslist;return e?angular.fromJson(e):[]},save:function(e){window.localStorage.drugslist=angular.toJson(e)},add:function(e){var t=this.all();~t.indexOf(e)||t.push(e),this.save(t)},remove:function(e){var t=this.all(),n=t.indexOf(e);~n&&(t.splice(n,1),this.save(t))}}})}(),angular.module("pattern.controllers",[]).controller("PatternCtrl",["$scope",function(e){e.options=[{name:"Abilify"},{name:"Namenda"},{name:"Viagra"},{name:"Zetia"},{name:"Cialis"},{name:"Nasonex"}]}]),angular.module("pattern",["pattern.controllers","pattern.routes"]),angular.module("pattern.routes",[]).config(["$routeProvider",function(e){e.when("/pattern",{templateUrl:"assets/pattern/partials/main.html",controller:"PatternCtrl"})}]);